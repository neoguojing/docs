# Stable Diffusion 图像到图像生成技术笔记
## 1. 概述
- 图像到图像生成利用已有图像进行有针对性的修改，如风格迁移、物体增删、图像修复等。

- Stable Diffusion 通过扩散模型和潜在空间的操作，在图像编辑领域表现出色。

## 2. Stable Diffusion 主要架构
- VAE（变分自编码器）： 负责将图像编码到潜在空间并解码回像素空间，提高计算效率。

- U-Net: 负责去噪，恢复图像的结构，核心组件。

- 文本编码器（CLIP等）： 将文本提示编码为向量，以影响生成过程（可选）。

## 3. 扩散模型原理
- 前向扩散（加噪）： 逐步向图像添加噪声，最终变为高斯噪声。

- 反向扩散（去噪）： 从噪声开始，逐步预测并去除噪声以重建图像。

## 4. 潜在空间的作用
- 通过 VAE 进行降维，降低计算成本与内存需求，并提取图像的关键特征。

- 使得潜在空间操作如插值、漫步成为可能。

## 5. 基于输入图像的条件生成
- ControlNet: 结合结构信息（边缘、深度等）增强控制能力。

- IP-Adapter: 提取输入图像的风格特征并应用于生成过程。

- 交叉注意力: 使得输入图像、文本提示能够影响生成图像。

## 6. 注意力机制与 Transformer
- 自注意力: 处理图像不同区域的重要性。

- 交叉注意力: 结合输入图像或文本信息调整生成结果。

- 扩散 Transformer (DiT): 取代 U-Net，增强复杂结构建模能力（如 Stable Diffusion 3）。

## 7. 训练与优化
- 预训练使用大型数据集（如 LAION-5B）。

- 微调方法：

- LoRA（低秩适应）： 轻量级微调特定风格或任务。

- DreamBooth： 使模型适应特定人物或概念。

## 8. 损失函数
- MSE（均方误差）： 预测噪声误差，扩散模型的主要损失函数。

- 感知损失（VGG等）： 关注视觉质量，提升人类感知效果。

## 9. 图像到图像应用
- 风格迁移： 变换图像风格（如艺术风格）。
- 图像修复与补全： 填补缺失部分或修复损坏图像。
- 超分辨率： 提高图像质量和清晰度。
- 条件编辑： 基于文本或参考图像进行修改（如 ControlNet）。

